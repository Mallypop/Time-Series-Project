\documentclass[11pt, a4paper]{article} %or article has only section and below, book and report also have chapter: http://texblog.org/2007/07/09/documentclassbook-report-article-or-letter/
\usepackage{float}
\usepackage[utf8]{inputenc} % use utf8 encoding of symbols such as umlaute for maximal compatibility across platforms
\usepackage{caption} % provides commands for handling caption sizes etc.
%\usepackage[a4paper, left=25mm, right=20mm, top=25mm, bottom=20mm]{geometry} % to easily change margin widths: https://www.sharelatex.com/learn/Page_size_and_margins
\usepackage[bottom]{footmisc} % I love footnotes! And they should be down at the bottom of the page!
\usepackage{graphicx} % when using figures and alike
\usepackage[hidelinks]{hyperref} % for hyperreferences (links within the document: references, figures, tables, citations)
\usepackage{euler} % a math font, only for equations and alike; call BEFORE changing the main font; alternatives: mathptmx, fourier,
%\usepackage{gentium} % for a different font; you can also try: cantarell, charter, libertine, gentium, bera, ... http://tex.stackexchange.com/questions/59403/what-font-packages-are-installed-in-tex-live
%------------------------------------------------------------------------------------------------------
%------- text size settings --------------
\setlength{\textwidth}{16cm}%
\setlength{\textheight}{25cm} %23
%(these values were used to fill the page more fully and thus reduce the number of pages!)
\setlength{\topmargin}{-1.5cm} %0
\setlength{\footskip}{1cm} %
%\setlength{\hoffset}{0cm} %
\setlength{\oddsidemargin}{1cm}%
\setlength{\evensidemargin}{-.5cm}%
\setlength{\parskip}{0cm} % Abstand zwischen Absätzen
% ----------------------------------------------------------------
\renewcommand{\textfraction}{0.1} % allows more space to graphics in float
\renewcommand{\topfraction}{0.85}
%\renewcommand{\bottomfraction}{0.65}
\renewcommand{\floatpagefraction}{0.70}
\frenchspacing %http://texwelt.de/wissen/fragen/1154/was-ist-french-spacing-was-macht-frenchspacing
%------------------------------------------------------------------------------------------------------
%------------------------------------------------------------------------------------------------------
\usepackage{Sweave}
\begin{document}
\input{sweaveclean-concordance}
\title{Time Series Analysis - A Tutorial}
\author{Rosskopf,E.; Cordes, M.; Lumiko, J.}
% for more control, multiple affiliations, line breaks and alike, use the authblk package!!
\date{\today} % !!use package isodate for more control of date formatting!!
\maketitle
\abstract{Tutorial for time series analysis in R... }
\tableofcontents
\pagebreak
\section{Introduction}%------------------------------------------------------------------------------------
This tutorial assumes that the reader has some basic knowledge of time series analysis, and the principal focus of the tutorial is not to explain time series analysis, but rather to explain how to carry out these analyses using R.
\noindent 
If you are new to time series analysis, and want to learn more about any of the concepts presented here, We would highly recommend the Open University book “Time series” (product code M249/02), available from from the Open University Shop.

%\begin{itemize}
%\item Definition time series\\
%\item examples in economy, nature, humans,.... \\
%\item stochastic/deterministic with dormann revision\\
%\item stationary / non stationary \\
%\item regression: why time series regression instead of linear standrard regression\\
%\item where you need to use time series regression.\\
%\end{itemize}


\section{Getting started}%------------------------------------------------------------------------------------
\subsection{Packages}
Before we get started, please make sure to set a working directory and download the necessary packages listed below.\\

\noindent Useful packages for time series analysis:

\begin{Schunk}
\begin{Sinput}
> library(tseries)
> library(nlme)
> library(car)
> library(knitr)
> library(xtable)
> library(SweaveListingUtils)
> library(stats)
> library(forecast)
> library(AICcmodavg)
> library(TTR)
\end{Sinput}
\end{Schunk}

\subsection{Dataset (CO2-Concentrations)}%------------------------------------------------------------------------------------
The first dataset we will work with consists of monthly CO2-concentrations [ppm] in the atmosphere, measured over time at the famous Mauna Loa Station on Hawaii.\\
To download this dataset, just use the code provided below.

\begin{Schunk}
\begin{Sinput}
> url<-"ftp://aftp.cmdl.noaa.gov/products/trends/co2/co2_mm_mlo.txt"
> dest<-"C:/Users/Mallypop/Desktop/FINAL SWEAVE VERSION/myts.txt"
> download.file(url, dest ) 
> co2month=read.table(dest, skip=72)
> co2month
\end{Sinput}
\end{Schunk}

\noindent Note:"dest'' represents a randomly chosen  name for a text file in which the CO2-dataset will be saved. Feel free to adjust the name and directory.


\subsection{Dataset Visualization}%-----------------------------------------------------------------------------------
It can be really useful to visualize your dataset before you transform it into a timeseries (ts) in order to detect potential errors.

\subsubsection{Histogram \& QQ-Plot}
\begin{Schunk}
\begin{Sinput}
> data = co2month[,c(3,5)]
> colnames(data)= c("year", "co2")
> attach(data)
> x = co2
> op = par(mfrow = c(1,2),
+           mar = c(5,4,1,2)+.1,
+           oma = c(0,0,2,0))
> hist(co2, freq=F, col = "cornsilk",xlab = "", main = "")
> qqnorm(x, main = ""); qqline(x,col = 'red')
> par(op)
> mtext("CO2 Concentration (ppm) Histogram and QQ Plot", line = 2.5,font = 2,cex = 1.0)
\end{Sinput}
\end{Schunk}
\includegraphics{sweaveclean-fig1check}

\subsubsection{Plotting the fitted values}
\begin{figure}[H]
\centering
\begin{Schunk}
\begin{Sinput}
> # Run a linear model
> #
> datalm = lm( co2 ~ year)
> #
> # Fit predict values
> #
> MyData=data.frame(year=seq(from=(1958),to=2014, by=0.1))
> pred=predict(datalm, newdata=MyData, type="response", se=T) #poission: type ="LINK", binomial: type="RESPONSE"
> #
> # Plot the fitted values
> #
> plot(year, co2, type="n",las=1, xlab="Year", ylab="CO2 conc. (ppm)", main="CO2 concentration in the atmosphere")
> grid (NULL,NULL, lty = 6, col = "cornsilk2") 
> points(year, co2, col="cornflowerblue" )
> #
> # Write confidence interval 
> #
> F=(pred$fit)
> FSUP=(pred$fit+1.96*pred$se.fit) # make upper conf. int. 
> FSLOW=(pred$fit-1.96*pred$se.fit) # make lower conf. int. 
> lines(MyData$year, F, lty=1, col="red", lwd=3)
> lines(MyData$year, FSUP,lty=1, col="red", lwd=3)
> lines(MyData$year, FSLOW,lty=1, col="red", lwd=3)
> legend("topleft",c("simple linear regression y~x", "monthly mean data"), 
+        pch=c(20,20), col=c("red", "cornflowerblue"))
>        
\end{Sinput}
\end{Schunk}
\includegraphics{sweaveclean-fig1datalm}
\end{figure}

\noindent This plot can be used to observe if there are outliers which could possibly bias the model. \\
However the poly-1 linear regression is not accurate in fitting the CO2-dataset. This is due to the present autocorrelation that not yet has been taken into account. Neglecting this factor will always effect the accuracy of the model results. The standard errors are lower than  their true values thus giving high statistical significance with a p-value lower than it should be. The clue in statistical modelling is to present the correct statistical evidence, which would be highly biased with a linear model.\\
\subsection{Dataset Transformation}
It is essential to transform your dataset into a timeseries (ts) if you seek for an accurate and extensive analysis of the data.

\noindent The data stored as a dataframe needs to be transformed with the important columns into the class of a time series to continue working on it properly. If you have monthly data you have to set the deltat of the function ts() to deltat=1/12 describing the sampling period parts between successive values xt and xt+1. Your time series should somehow look like table 1.\\

\noindent \textbf{Original Data}\\
\begin{Schunk}
\begin{Sinput}
> xtable(head(data), caption="Original CO2-Data")
\end{Sinput}
% latex table generated in R 3.1.2 by xtable 1.7-4 package
% Mon Nov 24 20:14:37 2014
\begin{table}[ht]
\centering
\begin{tabular}{rrr}
  \hline
 & year & co2 \\ 
  \hline
1 & 1958.21 & 315.71 \\ 
  2 & 1958.29 & 317.45 \\ 
  3 & 1958.38 & 317.50 \\ 
  4 & 1958.46 & 317.10 \\ 
  5 & 1958.54 & 315.86 \\ 
  6 & 1958.62 & 314.93 \\ 
   \hline
\end{tabular}
\caption{Original CO2-Data} 
\end{table}\end{Schunk}
\noindent \textbf{Transformation}\\
\begin{Schunk}
\begin{Sinput}
> yourts=ts(co2, c(1958,3),c(2014,10), deltat=1/12)
> class(yourts)
\end{Sinput}
[1] "ts"\end{Schunk}
%<<results=tex, echo=FALSE, print=TRUE >>=
%print(xtable(yourts, digits=2, label="yourts",caption="Your time series for monthly mean data"), size="\\tiny")
%@

\pagebreak

\subsection{Time-Series Visualization}%------------------------------------------------------------------------------------
It is important to get a quick overview of your data. Some simple plots for visualization are quite helpful.
\subsubsection{Time-Series Plot}
\begin{figure}[H]
\centering
\begin{Schunk}
\begin{Sinput}
> par(mfrow=c(1,1))
> plot.ts(yourts,las=1, xlab="Year", ylab="CO2 conc. (ppm)", main="CO2 concentration in the atmosphere")
> grid (NULL,NULL, lty = 6, col = "cornsilk2")
> points(yourts, col="cornflowerblue" )
> k <- 5
> lines(year,filter(co2, rep(1/k,k) ),col = 'red', type="l", lwd = 3)
> legend("topleft",c("simple moving average", "monthly mean data"),
+ pch=c(20,20), col=c("red", "cornflowerblue"))
\end{Sinput}
\end{Schunk}
\includegraphics{sweaveclean-fig1visualize}
\caption{Visualization of the CO2 Concentrations}
\label{fig1visualize}
\end{figure}
\noindent \textbf{Note: The red line in plot \ref{fig1visualize} was computed with a simple moving average. It is not enough to just run a MA.}\\

\pagebreak

\subsubsection{ACF, PACF, SPECTRUM}
\noindent Since time-series data usually violates the independence assumption of the model, the standard error is potentially too small. As the data are regularly spaced in time, we can easily employ the autocorrelation function to investigate residuals correlations in the model errors.\\
\textbf{The acf() function} can be used for that, which produces a plot of the correlogram.\\
Another nice procedure is to run the \textbf{autocorrelation  function} with its complementary \textbf{partial acf} and the \textbf{spectrum}  showing the spectral density of your time series at frequencies corresponding to the possibly approx. Fourier frequencies. \\ 

\begin{figure}[H]
\centering
\begin{Schunk}
\begin{Sinput}
> op <- par(mfrow = c(3,1),
+           mar = c(2,4,1,2)+.1,
+           oma = c(0,0,2,0))
> acf(x, xlab = "")
> pacf(x, xlab = "")
> spectrum(x, xlab = "", main = "")
> par(op)
> mtext("CO2 Concentration (ppm) correlogram", 
+       line = 2.5, 
+       font = 2, 
+       cex = 0.8)
> op <- par(mfrow = c(3,1),
+           mar = c(2,4,1,2)+.1,
+           oma = c(0,0,2,0))
> acf(resid(datalm), xlab = "")
> pacf(resid(datalm),xlab = "")
> spectrum(resid(datalm), xlab = "", main = "")
> par(op)
> mtext("Model residual correlogram", 
+       line = 2.5, 
+       font = 2, 
+       cex = 1.2)
\end{Sinput}
\end{Schunk}
\includegraphics{sweaveclean-fig:correlogram}
\caption{Correlogram of time series and residuals of lm}
\label{fig:correlogram}
\end{figure}


Explain the acf , pacf, spectrum here. \\
\textbf{ACF \& PACF:}\\
\noindent The generated correlogram  reveals that there are major autocorrelations. \\
There is a strong correlation at lag 1,a weaker correlation at lag 2, and a noticeable correlation at lag 3. Such a correlation pattern is typical for an autoregressive process where most of the sequential dependence can be explained as a  flow-on effect from a dependence at lag 1.\\

\noindent In an autoregressive time series, an independent error component, or ''innovation" is associated with each time point. For an order p autoregressive time series, the error for any time point is obtained by taking the innovation for that time point, and adding a linear combination of the innovations at the p previous time points. (For the present time series, initial indications are that p = 1 might capture most of the correlation structure.)"\\ (autosmooth.pdf)\\

\noindent \textbf{Spectrum:} easier to interpret the acf / log scaled / strong cycles where spectrum max. occurs 
Here the highest maximum is at about 0.75. 1/0.75 = 12 meaning a 12 month cycle is occuring here .\\

\noindent The residuals in a time series are serially correlated. The ACF is waving and decreases only slowly, which could be an identification of non-stationarity ( If the ACF would drop to zero quickly, the time series would be stationary). We stop all diagnostics here for our clearly wrong model and go on to investigate the different components of our time series.\\


\section{Decomposition of Time Series}%-----------------------------------------------------------------------------------------------------
A time serie consists of 3 components; a trend component, an irregular (random) component and (if it is a seosonal time series) seasonal component.
\subsection{Decomposing Seasonal Data}%---------------------------------------------------------------------------------------------------- 

\noindent We can decompose the ts and plot these components:

\begin{figure}[H]
\centering
\begin{Schunk}
\begin{Sinput}
> plot(decompose(yourts)) 
> 
\end{Sinput}
\end{Schunk}
\includegraphics{sweaveclean-decompose}
\caption{Decomposition of the CO2 Time Series}
\end{figure}


\noindent We can see each component with:
\begin{Schunk}
\begin{Sinput}
> yourts_components<- decompose(yourts)
\end{Sinput}
\end{Schunk}
\begin{Schunk}
\begin{Sinput}
> yourts_components$seasonal
\end{Sinput}
\end{Schunk}

It seems that our seasonal component is positiv until the sommer months, were it turns to be negativ and turning to be positiv again in the winter

\begin{figure}[H]
\centering
\begin{Schunk}
\begin{Sinput}
> par(mfrow=c(1,2))
> #we can see the trend for the first year:
> ts.plot(yourts_components$seasonal[1:12])
> 
\end{Sinput}
\end{Schunk}
\includegraphics{sweaveclean-decomposition}
\begin{Schunk}
\begin{Sinput}
> ts.plot(aggregate(yourts_components$seasonal))
> #and we can see that this seasonal component is constant over all the years
> 
> yourts_seasonallyadjusted <- yourts - yourts_components$seasonal
> #We can then plot the seasonally adjusted time series using "plot()" 
\end{Sinput}
\end{Schunk}
\includegraphics{sweaveclean-seasonal_component}
\begin{Schunk}
\begin{Sinput}
> plot(yourts, main="TS with seasonal fl.", las=1)
\end{Sinput}
\end{Schunk}
\includegraphics{sweaveclean-seasonallyadjusted}
\begin{Schunk}
\begin{Sinput}
> plot(yourts_seasonallyadjusted, las=1, main="removed seasonal fluctuation")
> 
> 
\end{Sinput}
\end{Schunk}
\includegraphics{sweaveclean-notseasonallyadjusted}
\caption{The seasonal component across the time}
\label{decomposition}
\end{figure}


\noindent It seems that our data can probably be described using an additive model, since the random fluctuations in the data are roughly constant in size over time (constant seasonal component)

\subsection{Decomposing Non-Seasonal Data (Annual Flow Of The River Nile)}

Our second dataset contains the measurements of the annual flow of the river Nile at Ashwan.(1871–1970) This dataset can be found in the package{datasets}. \\

\noindent First we visualize our data:\\
\begin{figure}[H]
\centering
\begin{Schunk}
\begin{Sinput}
> str(Nile)
\end{Sinput}
\begin{Soutput}
 Time-Series [1:100] from 1871 to 1970: 1120 1160 963 1210 1160 1160 813 1230 1370 1140 ...
\end{Soutput}
\begin{Sinput}
> plot(Nile, main="Annual flow of teh Nile", ylab="Flow [V/a]")
\end{Sinput}
\end{Schunk}
\caption{Annual Flow of the Nile}
\end{figure}

\noindent A non-seasonal time series consists of a trend and an irregular component. To estimate the trend component of a non-seasonal time series that can be described using an additive model, it is common to use a smoothing method, such as calculating the simple moving average of the time series.

\noindent The SMA() function in the “TTR” R package can be used to smooth time series data using a simple moving average. 
\begin{figure}[H]
\centering
\begin{Schunk}
\begin{Sinput}
> library(TTR)
> plot(SMA(Nile,n=20))
\end{Sinput}
\end{Schunk}
\includegraphics{sweaveclean-017}
\caption{Trend of the Annual Flow of the Nile}
\end{figure}

\noindent We can see that there was a negative trend until 1920 and that it becomes positiv since then. However it is difficult to make a clear statement of the trends, since there are high fluctuations in the data.


\noindent Now we can procede plotting the correlograms:
\begin{figure}[H]
\centering
\begin{Schunk}
\begin{Sinput}
> par(mfrow = c(1, 2))
> acf(Nile)
> pacf(Nile)
> par(mfrow = c(1, 1))
\end{Sinput}
\end{Schunk}
\includegraphics{sweaveclean-018}
\caption{Autocorrelations and Partial autocorrelations.}
\end{figure}

\noindent We find a significant autocorrelation at the first lags only. This means that the autocorrelation is not constant over time.
The  partial autocorrelation plot does not show any significant autocorrelation 

\section{Modelling the time series}
The best model for a time series needs to have residuals as white noise terms. 
There are different ways to approach this task. 


\section{Forecasts}%----------------------------------------------------------------------------------------------------
We have three different options to make ( up to now)
\begin{enumerate}
  \item predict
  \item Holt Winters
  \item Arima forecasts
\end{enumerate}


\subsection{Holt-Winters Exponential Smoothing}%-----------------------------------------------------------------------------------------------

If we have a time series that can be described using an additive model,we can short-time forecast using exponential smoothing.\\
Preconditions:forecast errors are uncorrelated and are normally distributed with mean zero and constant variance.
\begin{Schunk}
\begin{Sinput}
> hw<-HoltWinters(yourts)
> #the alpha value tells us the weight of the previous values for the forecasting
> #values of alpha that are close to 0 mean that little weight is placed on the most recent observations when making forecasts of future values
> #gamma is for the seasonality
> plot(hw)
> 
\end{Sinput}
\end{Schunk}

\noindent Holtwinters just makes forecasts for the time period covered by the original data.If we want to forecast for the future, we need the packeged "forecast".\\

\begin{figure}[H]
\centering
\begin{Schunk}
\begin{Sinput}
> hw1<- forecast.HoltWinters(hw, h=12)
> #for the next year  
> plot.forecast(hw1, main="Prediction for the next year",shadecols = "oldstyle")
> #for next 10 years
> hw10<- forecast.HoltWinters(hw, h=120)
> plot.forecast(hw10, main="Prediction for the next 10 years", shadecols = "oldstyle")
\end{Sinput}
\end{Schunk}
\includegraphics{sweaveclean-020}
\caption{Forecasting using Holt Winters exponential smoothing}
\end{figure}

\noindent Here the forecasts for 1913-1920 are plotted as a blue line, the 80% prediction interval as an orange shaded area, and the 95% prediction interval as a yellow shaded area.

\noindent The ‘forecast errors’ are calculated as the observed values minus the predicted values, for each time point. We can only calculate the forecast errors for the time period covered by our original time series. One measure of the accuracy of the predictive model is the sum-of-squared-errors (SSE) for the in-sample forecast errors.

\noindent To calculate a correlogram of the in-sample forecast errors for the CO2 Time series data for lags 1-20, we type:

\begin{figure}[H]
\centering
\begin{Schunk}
\begin{Sinput}
> acf(hw10$residuals, lag.max=20)
\end{Sinput}
\end{Schunk}
\includegraphics{sweaveclean-021}
\caption{Correlogram of the residuals.}
\end{figure}

\begin{Schunk}
\begin{Sinput}
> Box.test(hw10$residuals, lag=20, type="Ljung-Box")
\end{Sinput}
\begin{Soutput}
	Box-Ljung test

data:  hw10$residuals
X-squared = 37.5445, df = 20, p-value = 0.01006
\end{Soutput}
\end{Schunk}
There is little evidence of non-zero autocorrelations at lags 1-20.

\begin{Schunk}
\begin{Sinput}
> plotForecastErrors <- function(forecasterrors)
+   {
+      # make a histogram of the forecast errors:
+      mybinsize <- IQR(forecasterrors)/4
+      mysd   <- sd(forecasterrors)
+      mymin  <- min(forecasterrors) - mysd*5
+      mymax  <- max(forecasterrors) + mysd*3
+      # generate normally distributed data with mean 0 and standard deviation mysd
+      mynorm <- rnorm(10000, mean=0, sd=mysd)
+      mymin2 <- min(mynorm)
+      mymax2 <- max(mynorm)
+      if (mymin2 < mymin) { mymin <- mymin2 }
+      if (mymax2 > mymax) { mymax <- mymax2 }
+      # make a red histogram of the forecast errors, with the normally distributed data overlaid:
+      mybins <- seq(mymin, mymax, mybinsize)
+      hist(forecasterrors, col="red", freq=FALSE, breaks=mybins)
+      # freq=FALSE ensures the area under the histogram = 1
+      # generate normally distributed data with mean 0 and standard deviation mysd
+      myhist <- hist(mynorm, plot=FALSE, breaks=mybins)
+      # plot the normal curve as a blue line on top of the histogram of forecast errors:
+      points(myhist$mids, myhist$density, type="l", col="blue", lwd=2)
+   }
\end{Sinput}
\end{Schunk}


\begin{figure}[H]
\centering
\begin{Schunk}
\begin{Sinput}
> plotForecastErrors(hw10$residuals)
\end{Sinput}
\end{Schunk}
\caption{Histogram of the errors}
\end{figure}

\noindent The histogram of the time series shows that the forecast errors are roughly normally distributed and the mean seems to be close to zero. 


\subsection{Seasonal Decomposition of Time Series by Loess}
Forecasting using stl objects:
\begin{figure}[H]
\centering
\begin{Schunk}
\begin{Sinput}
> plot(stlf(yourts, lambda=0, h =120))
> (tslm(yourts~time(yourts)))
\end{Sinput}
\begin{Soutput}
Call:
lm(formula = formula, data = "yourts", na.action = na.exclude)

Coefficients:
 (Intercept)  time(yourts)  
   -2618.494         1.494  
\end{Soutput}
\end{Schunk}
\includegraphics{sweaveclean-025}
\caption{Forecasting using Loess}
\end{figure}


\subsection{ARIMA Models}%-----------------------------------------------------------------------------------------------
For the CO2 time series:
\begin{Schunk}
\begin{Sinput}
> au=auto.arima(yourts, ic = "bic")
> arima1=arima(yourts, order = c(au$arma[1],au$arma[6],au$arma[2]))
> fore1=forecast.Arima(arima1,h=10)
> plot.forecast(fore1)
> 
\end{Sinput}
\end{Schunk}
\includegraphics{sweaveclean-026}

We can first fit an autoregression model to the Nile Time Series:
\begin{figure}[H]
\centering
\begin{Schunk}
\begin{Sinput}
> ar(Nile) # selects order 2
\end{Sinput}
\begin{Soutput}
Call:
ar(x = Nile)

Coefficients:
     1       2  
0.4081  0.1812  

Order selected 2  sigma^2 estimated as  21247
\end{Soutput}
\begin{Sinput}
> cpgram(ar(Nile)$resid)
> arima(Nile, c(2, 0, 0))
\end{Sinput}
\begin{Soutput}
Series: Nile 
ARIMA(2,0,0) with non-zero mean 

Coefficients:
         ar1     ar2  intercept
      0.4096  0.1987   919.8397
s.e.  0.0974  0.0990    35.6410

sigma^2 estimated as 20291:  log likelihood=-637.98
AIC=1283.96   AICc=1284.38   BIC=1294.38
\end{Soutput}
\begin{Sinput}
> 
\end{Sinput}
\end{Schunk}
\includegraphics{sweaveclean-027}
\caption{Cumulative Peridiogram of the residuals}
\end{figure}
Fitting a autoregressive model, we can see that the residuals are well placed.

Structural time series models:
\begin{figure}[H]
\centering
\begin{Schunk}
\begin{Sinput}
> par(mfrow = c(3, 1))
> plot(Nile)
> ## local level model
> (fit <- StructTS(Nile, type = "level"))
\end{Sinput}
\begin{Soutput}
Call:
StructTS(x = Nile, type = "level")

Variances:
  level  epsilon  
   1469    15099  
\end{Soutput}
\begin{Sinput}
> lines(fitted(fit), lty = 2)              # contemporaneous smoothing
> lines(tsSmooth(fit), lty = 2, col = 4)   # fixed-interval smoothing
> plot(residuals(fit)); abline(h = 0, lty = 3)
> ## local trend model
> (fit2 <- StructTS(Nile, type = "trend")) ## constant trend fitted
\end{Sinput}
\begin{Soutput}
Call:
StructTS(x = Nile, type = "trend")

Variances:
  level    slope  epsilon  
   1427        0    15047  
\end{Soutput}
\begin{Sinput}
> pred <- predict(fit, n.ahead = 30)
> ## with 50% confidence interval
> ts.plot(Nile, pred$pred,
+         pred$pred + 0.67*pred$se, pred$pred -0.67*pred$se, col=1:3)
> 
> 
\end{Sinput}
\end{Schunk}
\includegraphics{sweaveclean-028}
\caption{Fitting a Structural Model}
\end{figure}


\subsection{Selecting a Candidate ARIMA Model}%-----------------------------------------------------------------------------------------------

TEXT

\subsection{Forecasting Using an ARIMA Model}%-----------------------------------------------------------------------------------------------

compare both functions of forecasting: 
\begin{figure}[H]
\centering
\begin{Schunk}
\begin{Sinput}
> par(mfrow=c(1,2))
> plot(forecast.arima, xlim=c(2010,2025), ylim=c(385,430))
> plot.forecast(forecasts2 ,xlim=c(2010,2025), ylim=c(385,430))
\end{Sinput}
\end{Schunk}
\caption{Model Comparisons}
\end{figure}



\section{Links and Further Reading}%-----------------------------------------------------------------------------------------------

and in:\\

http://cran.r-project.org/web/views/TimeSeries.html\\

Another Exemple Datasets are avaliable at:\\

http://www.comp-engine.org/timeseries/browse-data-by-category\\
https://datamarket.com/data/list/?q=provider:tsdl\\

\section{Acknowledgements}%------------------------------------------------------------------------------------------------------
Don't forget to thank TeX and R and other opensource communities if you use their products! The correct way to cite R is shown when typing ``\texttt{citation()}'', and ``\texttt{citation("mgcv")}'' for packages.

\clearpage
\end{document}

